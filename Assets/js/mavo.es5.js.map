{"version":3,"sources":["util.js"],"names":["$","$$","_","extend","Mavo","load","url","base","document","currentScript","src","location","loaded","Set","has","URL","test","pathname","create","head","Promise","resolve","include","readFile","file","format","reader","FileReader","reject","onload","result","onerror","onabort","toJSON","data","JSON","stringify","safeToJSON","o","cache","self","WeakSet","key","value","add","objectify","properties","primitive","Symbol","toStringTag","constructor","name","valueOf","toPrimitive","toArray","arr","undefined","Array","isArray","delete","element","all","index","indexOf","splice","flatten","reduce","prev","c","concat","pushUnique","item","push","union","set1","set2","filter","callback","i","length","is","thing","elements","matches","selectors","getStyle","property","getComputedStyle","getPropertyValue","trim","elementData","get","ret","arguments","set","WeakMap","elementPath","ancestor","path","acc","cur","children","last","offset","split","firstChild","nextSibling","parent","parentNode","countNonElementSiblings","nodeType","sibling","unshift","revocably","comment","isRemoved","replaceChild","appendChild","remove","commentText","id","className","nodeName","createComment","setAttribute","attribute","previousValue","getAttribute","restoreAttribute","toggleAttribute","inView","r","getBoundingClientRect","bottom","innerHeight","top","right","innerWidth","left","when","observer","IntersectionObserver","entries","forEach","unobserve","entry","target","fire","observe","removeEventListener","evt","stopPropagation","addEventListener","scrollIntoViewIfNeeded","scrollIntoView","behavior","setAttributeShy","hasAttribute","attributes","getTarget","hash","substr","getElementById","in","obj","getCanonicalProperty","toLowerCase","propertyL","Object","keys","map","p","subset","slice","meta","Functions","query","clone","parse","debounce","fn","delay","timer","code","context","args","apply","clearTimeout","setTimeout","timeout","escapeRegExp","s","replace","str","regex","match","observeResize","callbackOrObserver","ResizeObserver","previousRect","ro","contentRect","width","height","Observer","Class","MutationObserver","options","attributeFilter","attributeOldValue","oldValue","characterData","childList","subtree","characterDataOldValue","run","stop","disconnect","running","sneak","destroy","static","defer","res","rej","promise","a","thenAll","iterable","type","catch","err","then","resolved","rr","f","wrap","option","pair","removeAttribute","proxy","classProps","overload","defineProperty","configurable","enumerable","propagated","proto","names","existing","propagate","updateTargetWithin","cl","el","classList","idObserver","documentElement","Bliss"],"mappings":"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","file":"../mavo.es5.js","sourcesContent":["(function ($, $$) {\n\nvar _ = $.extend(Mavo, {\n\t/**\n\t * Load a file, only once\n\t */\n\tload: (url, base = document.currentScript? document.currentScript.src : location) => {\n\t\t_.loaded = _.loaded || new Set();\n\n\t\tif (_.loaded.has(url + \"\")) {\n\t\t\treturn;\n\t\t}\n\n\t\turl = new URL(url, base);\n\n\t\tif (/\\.css$/.test(url.pathname)) {\n\t\t\t// CSS file\n\t\t\t$.create(\"link\", {\n\t\t\t\t\"href\": url,\n\t\t\t\t\"rel\": \"stylesheet\",\n\t\t\t\t\"inside\": document.head\n\t\t\t});\n\n\t\t\t// No need to wait for stylesheets\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\t// JS file\n\t\treturn $.include(url);\n\t},\n\n\treadFile: (file, format = \"DataURL\") => {\n\t\tvar reader = new FileReader();\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\treader.onload = f => resolve(reader.result);\n\t\t\treader.onerror = reader.onabort = reject;\n\t\t\treader[\"readAs\" + format](file);\n\t\t});\n\t},\n\n\ttoJSON: data => {\n\t\tif (data === null) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\tif (typeof data === \"string\") {\n\t\t\t// Do not stringify twice!\n\t\t\treturn data;\n\t\t}\n\n\t\treturn JSON.stringify(data, null, \"\\t\");\n\t},\n\n\t/**\n\t * toJSON without cycles\n\t */\n\tsafeToJSON: function(o) {\n\t\tvar cache = self.WeakSet? new WeakSet() : new Set();\n\n\t\treturn JSON.stringify(o, (key, value) => {\n\t\t\tif (typeof value === \"object\" && value !== null) {\n\t\t\t\t// No circular reference found\n\n\t\t\t\tif (cache.has(value)) {\n\t\t\t\t\treturn; // Circular reference found!\n\t\t\t\t}\n\n\t\t\t\tcache.add(value);\n\t\t\t}\n\n\t\t\treturn value;\n\t\t});\n\t},\n\n\tobjectify: (value, properties) => {\n\t\tvar primitive = Mavo.value(value);\n\n\t\tif (typeof value !== \"object\" || value === null) {\n\t\t\tif (value === null) {\n\t\t\t\tvalue = {\n\t\t\t\t\t[Symbol.toStringTag]: \"Null\",\n\t\t\t\t\ttoJSON: () => null\n\t\t\t\t};\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar constructor = value.constructor;\n\t\t\t\tvalue = new constructor(primitive);\n\t\t\t\tvalue[Symbol.toStringTag] = constructor.name;\n\t\t\t}\n\n\t\t\tvalue.valueOf = value[Symbol.toPrimitive] = () => primitive;\n\t\t}\n\n\t\treturn $.extend(value, properties);\n\t},\n\n\tvalue: value => value && value.valueOf? value.valueOf() : value,\n\n\t/**\n\t * Array & set utlities\n\t */\n\n\t// If the passed value is not an array, convert to an array\n\ttoArray: arr => {\n\t\treturn arr === undefined? [] : Array.isArray(arr)? arr : [arr];\n\t},\n\n\t// Delete an element from an array\n\t// @param all {Boolean} Delete more than one?\n\tdelete: (arr, element, all) => {\n\t\tdo {\n\t\t\tvar index = arr && arr.indexOf(element);\n\n\t\t\tif (index > -1) {\n\t\t\t\tarr.splice(index, 1);\n\t\t\t}\n\t\t} while (index > -1 && all);\n\t},\n\n\t// Recursively flatten a multi-dimensional array\n\tflatten: arr => {\n\t\tif (!Array.isArray(arr)) {\n\t\t\treturn [arr];\n\t\t}\n\n\t\treturn arr.reduce((prev, c) => _.toArray(prev).concat(_.flatten(c)), []);\n\t},\n\n\t// Push an item to an array iff it's not already in there\n\tpushUnique: (arr, item) => {\n\t\tif (arr.indexOf(item) === -1) {\n\t\t\tarr.push(item);\n\t\t}\n\t},\n\n\tunion: (set1, set2) => {\n\t\treturn new Set([...(set1 || []), ...(set2 || [])]);\n\t},\n\n\t// Filter an array in place\n\t// TODO add index to callback\n\tfilter: (arr, callback) => {\n\t\tfor (var i=0; i<arr.length; i++) {\n\t\t\tif (!callback(arr[i])) {\n\t\t\t\tarr.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * DOM element utilities\n\t */\n\n\tis: function(thing, ...elements) {\n\t\tfor (let i=0, element; i < elements.length; i++) {\n\t\t\telement = elements[i];\n\n\t\t\tif (element && element.matches && element.matches(_.selectors[thing])) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t/**\n\t * Get the current value of a CSS property on an element\n\t */\n\tgetStyle: (element, property) => {\n\t\tif (element) {\n\t\t\tvar value = getComputedStyle(element).getPropertyValue(property);\n\n\t\t\tif (value) {\n\t\t\t\treturn value.trim();\n\t\t\t}\n\t\t}\n\t},\n\t/**\n\t * Get/set data on an element\n\t */\n\tdata: function(element, name, value) {\n\t\tvar data = _.elementData.get(element) || {}, ret;\n\n\t\tif (arguments.length == 2) {\n\t\t\tret = data[name];\n\t\t}\n\t\telse if (value === undefined) {\n\t\t\tdelete data[name];\n\t\t}\n\t\telse {\n\t\t\tret = data[name] = value;\n\t\t}\n\n\t\t_.elementData.set(element, data);\n\t\treturn ret;\n\t},\n\n\telementData: new WeakMap(),\n\n\t/**\n\t * Get node from path or get path of a node to an ancestor\n\t * For maximum robustness, all but the last path segment refer to elements only.\n\t * The last part of the path is a decimal: the integer part of the decimal is element index,\n\t * the decimal part is node index *after* that element and starts from 1.\n\t * If the node has no previous element sibling, the integer part of the index will be -1.\n\t */\n\telementPath: function (ancestor, element) {\n\t\tif (Array.isArray(element)) {\n\t\t\t// Get element by path\n\t\t\tvar path = element;\n\n\t\t\tvar ret = path.reduce((acc, cur) => {\n\t\t\t\treturn acc.children[cur >> 0] || acc;\n\t\t\t}, ancestor);\n\n\t\t\tvar last = path[path.length - 1];\n\n\t\t\tif (last != (last >> 0)) {\n\t\t\t\t// We are returning a non-element node\n\t\t\t\tvar offset = +(last + \"\").split(\".\")[1];\n\n\t\t\t\tif (last >> 0 < 0) {\n\t\t\t\t\tret = ret.firstChild;\n\t\t\t\t\toffset--;\n\t\t\t\t}\n\n\t\t\t\tfor (var i=0; i<offset; i++) {\n\t\t\t\t\tret = ret.nextSibling;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\t\telse {\n\t\t\t// Get path\n\t\t\tvar path = [];\n\n\t\t\tfor (var parent = element; parent && parent != ancestor; parent = parent.parentNode) {\n\t\t\t\tvar index = 0;\n\t\t\t\tvar countNonElementSiblings = parent === element && element.nodeType !== 1;\n\t\t\t\tvar offset = countNonElementSiblings? 1 : 0;\n\t\t\t\tvar sibling = parent;\n\n\t\t\t\twhile (sibling = sibling[`previous${countNonElementSiblings? \"\" : \"Element\"}Sibling`]) {\n\t\t\t\t\tif (countNonElementSiblings) {\n\t\t\t\t\t\toffset++;\n\n\t\t\t\t\t\tif (sibling.nodeType == 1) {\n\t\t\t\t\t\t\tcountNonElementSiblings = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tindex++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (offset > 0) {\n\t\t\t\t\tindex = index - 1 + \".\" + offset;\n\t\t\t\t}\n\n\t\t\t\tpath.unshift(index);\n\t\t\t}\n\n\t\t\treturn parent? path : null;\n\t\t}\n\t},\n\n\t/**\n\t * Revocably add/remove elements from the DOM\n\t */\n\trevocably: {\n\t\tadd: function(element, parent) {\n\t\t\tvar comment = _.revocably.isRemoved(element);\n\n\t\t\tif (comment && comment.parentNode) {\n\t\t\t\tcomment.parentNode.replaceChild(element, comment);\n\t\t\t}\n\t\t\telse if (element && parent && !element.parentNode) {\n\t\t\t\t// Has not been revocably removed because it has never even been added\n\t\t\t\tparent.appendChild(element);\n\t\t\t}\n\n\t\t\treturn comment;\n\t\t},\n\n\t\tremove: function(element, commentText) {\n\t\t\tif (!element) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar comment = _.data(element, \"commentstub\");\n\n\t\t\tif (!comment) {\n\t\t\t\tcommentText = commentText || element.id || element.className || element.nodeName;\n\t\t\t\tcomment = _.data(element, \"commentstub\", document.createComment(commentText));\n\t\t\t}\n\n\t\t\tif (element.parentNode) {\n\t\t\t\t// In DOM, remove\n\t\t\t\telement.parentNode.replaceChild(comment, element);\n\t\t\t}\n\n\t\t\treturn comment;\n\t\t},\n\n\t\tisRemoved: function(element) {\n\t\t\tif (!element || element.parentNode) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar comment = _.data(element, \"commentstub\");\n\n\t\t\tif (comment && comment.parentNode) {\n\t\t\t\treturn comment;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\tsetAttribute: function(element, attribute, value) {\n\t\t\tvar previousValue = _.data(element, \"attribute-\" + attribute);\n\n\t\t\tif (previousValue === undefined) {\n\t\t\t\t// Only set this when there's no old value stored, otherwise\n\t\t\t\t// if called multiple times, it could result in losing the original value\n\t\t\t\t_.data(element, \"attribute-\" + attribute, element.getAttribute(attribute));\n\t\t\t}\n\n\t\t\telement.setAttribute(attribute, value);\n\t\t},\n\n\t\trestoreAttribute: function(element, attribute) {\n\t\t\tvar previousValue = _.data(element, \"attribute-\" + attribute);\n\n\t\t\tif (previousValue !== undefined) {\n\t\t\t\t$.toggleAttribute(element, attribute, previousValue);\n\t\t\t\t_.data(element, \"attribute-\" + attribute, undefined);\n\t\t\t}\n\t\t}\n\t},\n\n\tinView: {\n\t\tis: element => {\n\t\t\tvar r = element.getBoundingClientRect();\n\n\t\t\treturn (0 <= r.bottom && r.bottom <= innerHeight || 0 <= r.top && r.top <= innerHeight) // vertical\n\t\t\t       && (0 <= r.right && r.right <= innerWidth || 0 <= r.left && r.left <= innerWidth); // horizontal\n\t\t},\n\n\t\twhen: element => {\n\t\t\tvar observer = _.inView.observer = _.inView.observer || new IntersectionObserver(function(entries) {\n\t\t\t\tentries.forEach(entry => {\n\t\t\t\t\tthis.unobserve(entry.target);\n\t\t\t\t\t$.fire(entry.target, \"mv-inview\", {entry});\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn new Promise(resolve => {\n\t\t\t\tif (_.is(element)) {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\n\t\t\t\tobserver.observe(element);\n\n\t\t\t\tvar callback = evt => {\n\t\t\t\t\telement.removeEventListener(\"mv-inview\", callback);\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\n\t\t\t\telement.addEventListener(\"mv-inview\", callback);\n\t\t\t});\n\t\t}\n\t},\n\n\tscrollIntoViewIfNeeded: element => {\n\t\tif (element && !Mavo.inView.is(element)) {\n\t\t\telement.scrollIntoView({behavior: \"smooth\"});\n\t\t}\n\t},\n\n\t/**\n\t * Set attribute only if it doesn’t exist\n\t */\n\tsetAttributeShy: function(element, attribute, value) {\n\t\tif (!element.hasAttribute(attribute)) {\n\t\t\telement.setAttribute(attribute, value);\n\t\t}\n\t},\n\n\t/**\n\t * Get the value of an attribute, with fallback attributes in priority order.\n\t */\n\tgetAttribute: function(element, ...attributes) {\n\t\tfor (let i=0, attribute; attribute = attributes[i]; i++) {\n\t\t\tlet value = element.getAttribute(attribute);\n\n\t\t\tif (value) {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t/**\n\t * Get the element identified by the URL hash\n\t */\n\tgetTarget: function() {\n\t\tvar id = location.hash.substr(1);\n\t\treturn document.getElementById(id);\n\t},\n\n\t/**\n\t * Object utilities\n\t */\n\n\t/**\n\t * Check if property exists in object. Like the in operator but more robust and does not throw.\n\t * Why not just in? E.g. \"foo\".length is 3 but \"length\" in \"foo\" throws\n\t */\n\tin: function(obj, property) {\n\t\tif (obj) {\n\t\t\treturn (typeof obj === \"object\" && property in obj) || obj[property] !== undefined;\n\t\t}\n\t},\n\n\t/**\n\t * Get real property name from case insensitive property\n\t */\n\tgetCanonicalProperty: function(obj, property) {\n\t\tif (obj && (property || property === 0)) {\n\t\t\t// Property in object?\n\t\t\tif (_.in(obj, property)) {\n\t\t\t\treturn property;\n\t\t\t}\n\n\t\t\tif (property.toLowerCase) {\n\t\t\t\t// Lowercase property in object?\n\t\t\t\tvar propertyL = property.toLowerCase();\n\n\t\t\t\tif (_.in(obj, propertyL)) {\n\t\t\t\t\treturn propertyL;\n\t\t\t\t}\n\n\t\t\t\t// Any case property in object?\n\t\t\t\tvar properties = Object.keys(obj);\n\t\t\t\tvar i = properties.map(p => p.toLowerCase()).indexOf(propertyL);\n\n\t\t\t\tif (i > -1) {\n\t\t\t\t\treturn properties[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tsubset: function(obj, path, value) {\n\t\tif (arguments.length == 3) {\n\t\t\t// Put\n\t\t\tif (path.length) {\n\t\t\t\tvar last = path[path.length - 1];\n\t\t\t\tvar parent = $.value(obj, ...path.slice(0, -1));\n\n\t\t\t\tif (Array.isArray(parent) && Array.isArray(value)) {\n\t\t\t\t\t// Merge arrays instead of adding array inside array\n\t\t\t\t\tparent.splice(last, 1, ...value);\n\t\t\t\t}\n\t\t\t\telse if (parent) {\n\t\t\t\t\tparent[path[path.length - 1]] = value;\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\t\telse if (typeof obj == \"object\" && path && path.length) { // Get\n\t\t\treturn path.reduce((obj, property, i) => {\n\t\t\t\tvar meta = {};\n\t\t\t\tvar ret = Mavo.Functions.get(obj, property, meta);\n\n\t\t\t\t// We don't yet support multiple properties at the same level\n\t\t\t\t// i.e. the path can't be for the 2nd and 3rd item\n\t\t\t\tpath[i] = Array.isArray(meta.property)? meta.property[0] : meta.property;\n\n\t\t\t\tif (ret === undefined && meta.query) {\n\t\t\t\t\t// Not found, return dummy if query\n\t\t\t\t\tret = {[meta.query.property]: meta.query.value};\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t}, obj);\n\t\t}\n\t\telse {\n\t\t\treturn obj;\n\t\t}\n\t},\n\n\tclone: function(o) {\n\t\treturn JSON.parse(_.safeToJSON(o));\n\t},\n\n\t// Credit: https://remysharp.com/2010/07/21/throttling-function-calls\n\tdebounce: function (fn, delay) {\n\t\tif (!delay) {\n\t\t\t// No throttling\n\t\t\treturn fn;\n\t\t}\n\n\t\tvar timer = null, code;\n\n\t\treturn function () {\n\t\t\tvar context = this, args = arguments;\n\n\t\t\tcode = function () {\n\t\t\t\tfn.apply(context, args);\n\t\t\t\tremoveEventListener(\"beforeunload\", code);\n\t\t\t};\n\n\t\t\tclearTimeout(timer);\n\t\t\ttimer = setTimeout(code, delay);\n\t\t\taddEventListener(\"beforeunload\", code);\n\t\t};\n\t},\n\n\ttimeout: delay => new Promise(resolve => setTimeout(resolve, delay)),\n\n\tescapeRegExp: s => s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, \"\\\\$&\"),\n\n\tmatches: (str, regex) => {\n\t\tvar ret = (str + \"\").match(regex);\n\t\treturn ret? ret : [];\n\t},\n\n\tmatch: (str, regex, i=0) => _.matches(str, regex)[i] || \"\",\n\n\tobserveResize: function(element, callbackOrObserver) {\n\t\tif (!self.ResizeObserver) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar previousRect = null;\n\t\tvar ro = callbackOrObserver instanceof ResizeObserver? callbackOrObserver : new ResizeObserver(entries => {\n\t\t\tvar contentRect = entries[entries.length - 1].contentRect;\n\n\t\t\tif (previousRect\n\t\t\t\t&& previousRect.width == contentRect.width\n\t\t\t\t&& previousRect.height == contentRect.height) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcallbackOrObserver(entries);\n\n\t\t\tpreviousRect = contentRect;\n\t\t});\n\n\t\tro.observe(element);\n\n\t\treturn ro;\n\t},\n\n\tObserver: $.Class({\n\t\tconstructor: function(element, attribute, callback, o = {}) {\n\t\t\tif (callback instanceof MutationObserver) {\n\t\t\t\tthis.observer = callback;\n\t\t\t}\n\n\t\t\tthis.observer = this.observer || new MutationObserver(callback);\n\t\t\tthis.element = element;\n\t\t\tthis.callback = callback;\n\t\t\tthis.attribute = attribute;\n\n\t\t\tthis.options = $.extend({}, o);\n\n\t\t\tif (attribute) {\n\t\t\t\t$.extend(this.options, {\n\t\t\t\t\tattributes: true,\n\t\t\t\t\tattributeFilter: this.attribute == \"all\"? undefined : Mavo.toArray(this.attribute),\n\t\t\t\t\tattributeOldValue: !!o.oldValue\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!this.attribute || this.attribute == \"all\") {\n\t\t\t\t$.extend(this.options, {\n\t\t\t\t\tcharacterData: true,\n\t\t\t\t\tchildList: true,\n\t\t\t\t\tsubtree: true,\n\t\t\t\t\tcharacterDataOldValue: !!o.oldValue\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.run();\n\t\t},\n\n\t\tstop: function() {\n\t\t\tif (this.observer) {\n\t\t\t\tthis.observer.disconnect();\n\t\t\t}\n\n\t\t\tthis.running = false;\n\n\t\t\treturn this;\n\t\t},\n\n\t\trun: function() {\n\t\t\tif (this.observer) {\n\t\t\t\tthis.observer.observe(this.element, this.options);\n\t\t\t\tthis.running = true;\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Disconnect an observer, run some code, then observe again\n\t\t */\n\t\tsneak: function(callback) {\n\t\t\tif (this.running) {\n\t\t\t\tthis.stop();\n\t\t\t\tvar ret = callback();\n\t\t\t\tthis.run();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar ret = callback();\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tdestroy: function() {\n\t\t\tthis.stop();\n\t\t\tthis.observer = this.element = null;\n\t\t},\n\n\t\tstatic: {\n\t\t\tsneak: function(observer, callback) {\n\t\t\t\treturn observer? observer.sneak(callback) : callback();\n\t\t\t}\n\t\t}\n\t}),\n\n\tdefer: function(constructor) {\n\t\tvar res, rej;\n\n\t\tvar promise = new Promise((resolve, reject) => {\n\t\t\tif (constructor) {\n\t\t\t\tconstructor(resolve, reject);\n\t\t\t}\n\n\t\t\tres = resolve;\n\t\t\trej = reject;\n\t\t});\n\n\t\tpromise.resolve = a => {\n\t\t\tres(a);\n\t\t\treturn promise;\n\t\t};\n\n\t\tpromise.reject = a => {\n\t\t\trej(a);\n\t\t\treturn promise;\n\t\t};\n\n\t\treturn promise;\n\t},\n\n\t/**\n\t * Similar to Promise.all() but can handle post-hoc additions\n\t * and does not reject if one promise rejects.\n\t */\n\tthenAll: function(iterable) {\n\t\t// Turn rejected promises into resolved ones\n\t\t$$(iterable).forEach(promise => {\n\t\t\tif ($.type(promise) == \"promise\") {\n\t\t\t\tpromise = promise.catch(err => err);\n\t\t\t}\n\t\t});\n\n\t\treturn Promise.all(iterable).then(resolved => {\n\t\t\tif (iterable.length != resolved.length) {\n\t\t\t\t// The list of promises or values changed. Return a new Promise.\n\t\t\t\t// The original promise won't resolve until the new one does.\n\t\t\t\treturn _.thenAll(iterable);\n\t\t\t}\n\n\t\t\t// The list of promises or values stayed the same.\n\t\t\t// Return results immediately.\n\t\t\treturn resolved;\n\t\t});\n\t},\n\n\t/**\n\t * Run & Return a function\n\t */\n\trr: function(f) {\n\t\tf();\n\t\treturn f;\n\t},\n\n\t// Get out of bounds array index to wrap around\n\twrap: (index, length) => index < 0? length - 1 : index >= length? 0 : index,\n\n\t/**\n\t * Parses a simple CSS-like text format for declaring key-value options:\n\t * Pairs are comma or semicolon-separated, key and value are colon separated.\n\t * Escapes are supported, via backslash. Useful for attributes.\n\t */\n\toptions: str => {\n\t\tvar ret = {};\n\n\t\t(str.trim().match(/(?:\\\\[,;]|[^,;])+/g) || []).forEach(option => {\n\t\t\tif (option) {\n\t\t\t\toption = option.trim().replace(/\\\\([,;])/g, \"$1\");\n\t\t\t\tvar pair = option.match(/^\\s*((?:\\\\:|[^:])+?)\\s*:\\s*(.+)$/);\n\n\t\t\t\tif (pair) {\n\t\t\t\t\tret[pair[1].replace(/\\\\:/g, \":\")] = pair[2];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// If no value, it's boolean\n\t\t\t\t\tret[option] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn ret;\n\t}\n});\n\n// Bliss plugins\n\n$.add(\"toggleAttribute\", function(name, value, test = value !== null) {\n\tif (test) {\n\t\tthis.setAttribute(name, value);\n\t}\n\telse {\n\t\tthis.removeAttribute(name);\n\t}\n});\n\n// Provide shortcuts to long property chains\n$.proxy = $.classProps.proxy = $.overload(function(obj, property, proxy) {\n\tObject.defineProperty(obj, property, {\n\t\tget: function() {\n\t\t\treturn this[proxy][property];\n\t\t},\n\t\tset: function(value) {\n\t\t\tthis[proxy][property] = value;\n\t\t},\n\t\tconfigurable: true,\n\t\tenumerable: true\n\t});\n\n\treturn obj;\n});\n\n$.classProps.propagated = function(proto, names) {\n\tMavo.toArray(names).forEach(name => {\n\t\tvar existing = proto[name];\n\n\t\tproto[name] = function() {\n\t\t\tvar ret = existing && existing.apply(this, arguments);\n\n\t\t\tif (this.propagate && ret !== false) {\n\t\t\t\tthis.propagate(name);\n\t\t\t}\n\t\t};\n\t});\n};\n\n// :target-within shim\nfunction updateTargetWithin() {\n\tvar element = _.getTarget();\n\tconst cl = \"mv-target-within\";\n\n\t$$(\".\" + cl).forEach(el => el.classList.remove(cl));\n\n\twhile (element && element.classList) {\n\t\telement.classList.add(cl);\n\t\telement = element.parentNode;\n\t}\n};\n\naddEventListener(\"hashchange\", updateTargetWithin);\nvar idObserver = new Mavo.Observer(document.documentElement, \"id\", updateTargetWithin);\n\n})(Bliss, Bliss.$);\n"]}